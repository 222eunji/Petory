<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ÌîåÎ†àÏù¥Ïä§</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Gowun+Batang&display=swap"
          rel="stylesheet">
    <style>
        :root {
            --petory-yellow: #fffbea;
            --petory-orange: #e3c187;
            --petory-brown: #cc8a3e;
            --petory-gray: #e5e5e5;
        }

        body {
            margin: 0;
            background: #f9f7f2;
            font-family: 'Montserrat', 'Gowun Batang', sans-serif;
            color: #222;
        }

        .navbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 40px 14px 40px;
            background: #fff;
            border-bottom: 1.5px solid #f3f0e9;
        }

        .navbar .logo {
            font-size: 1.3em;
            color: var(--petory-brown);
            font-weight: bold;
            letter-spacing: 2px;
            display: flex;
            align-items: center;
        }

        .navbar nav {
            display: flex;
            gap: 38px;
            font-size: 1em;
            font-weight: 500;
        }

        .navbar nav a {
            text-decoration: none;
            color: #222;
            transition: color .2s;
        }

        .navbar nav a:hover {
            color: var(--petory-orange);
        }

        .navbar .search-login {
            display: flex;
            align-items: center;
            gap: 22px;
        }

        .navbar .search {
            background: var(--petory-yellow);
            border-radius: 12px;
            border: 1px solid var(--petory-gray);
            padding: 7px 14px;
            display: flex;
            align-items: center;
        }

        .navbar .search input {
            border: none;
            background: transparent;
            font-size: 1em;
            outline: none;
            padding: 2px 4px;
            width: 90px;
        }

        .navbar .search svg {
            width: 18px;
            height: 18px;
            color: #bcae90;
        }

        .navbar .login {
            font-size: 1em;
            color: #333;
            text-decoration: none;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0 6px;
            font-weight: 500;
        }

        /* Î©îÏù∏ ÏΩòÌÖêÏ∏† */
        main {
            max-width: 1160px;
            margin: 0 auto;
            padding: 32px 0 0 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .category-row {
            display: flex;
            gap: 22px;
            margin: 24px 0 18px 0;
            align-items: center;
            width: 100%;
            max-width: 700px;
            overflow-x: auto;
            white-space: nowrap;
            padding: 14px 0 12px 0;
            scrollbar-width: none;
            background: #f1faee;
        }

        .category-row::-webkit-scrollbar {
            display: none;
        }

        .category-row .cat {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            min-width: 90px;
            max-width: 110px;
            padding: 8px 6px 6px 6px;
        }

        .category-row .cat:hover {
            background: #ffe7b6;
            color: #b58c3a;
            box-shadow: 0 3px 10px rgba(230, 180, 90, 0.09);
            transform: translateY(-7px) scale(1.09);
        }

        .category-row .cat img {
            width: 38px;
            margin-bottom: 0;
            transition: filter .18s;
            filter: grayscale(18%) brightness(1.03);
        }

        .category-row .cat:hover img {
            filter: none;
        }

        .category-row .cat span {
            margin-top: 2px;
            font-size: 0.60em;
            font-family: 'Montserrat', 'Gowun Batang', sans-serif;
            font-weight: 600;
            letter-spacing: 0.03em;
            color: inherit;
        }

        .cat.active {
            background: #fff7dd;
            color: var(--petory-orange);
            font-weight: bold;
            transform: scale(1.13);
            box-shadow: 0 3px 14px rgba(240, 180, 90, 0.11);
        }

        /* ÏßÄÎèÑ ÏòÅÏó≠ */
        .map-section {
            margin: 0 auto;
            width: 96%;
            max-width: 800px;
            border-radius: 40px;
            overflow: hidden;
            box-shadow: 0 2px 18px rgba(165, 150, 110, 0.09);
            background: #fff;
            margin-bottom: 50px;
            min-height: 380px;
            position: relative;
        }

        #map {
            width: 100%;
            height: 480px;
            border-radius: 40px;
            /* box-shadow inherit */
        }

        /* Ìë∏ÌÑ∞ */
        .footer {
            margin-top: 32px;
            background: none;
            color: #a8997c;
            font-size: 1em;
            text-align: center;
            padding: 26px 0 14px 0;
            display: flex;
            justify-content: center;
            gap: 90px;
        }

        .footer-section {
            min-width: 140px;
        }

        .footer .copyright {
            flex-basis: 100%;
            margin-top: 14px;
            font-size: 0.96em;
        }

        /* Î∞òÏùëÌòï(Î™®Î∞îÏùº) */
        @media (max-width: 900px) {
            main {
                max-width: 98vw;
            }

            .map-section {
                max-width: 99vw;
                min-height: 300px;
            }

            #map {
                min-height: 320px;
                height: 320px;
            }
        }

        .featured-area {
            width: 850px; /* Ïπ¥Îìú Í∑∏Î£π, Í≤ÄÏÉâÏ∞Ω, ÏùºÎü¨Ïä§Ìä∏ Í≥µÌÜµ Ìè≠ */
            max-width: 98vw;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .pet-illust {
            position: relative;
            z-index: 2;
            width: 100%;
            display: flex;
            justify-content: center;
            margin-top: 24px;
            margin-bottom: -60px; /* Í≤ÄÏÉâÏ∞ΩÏóê Í≤πÏπòÍ≤å ÏùåÏàò ÎßàÏßÑ */
        }

        .pet-illust img {
            width: 180px;
            height: auto;
            max-width: 320px;
            min-width: 180px;
            /* ÌÅ¨Í∏∞ ÎäòÎ¶¨Î†§Î©¥ ÏïÑÎûòÎ°ú */
            width: 240px;
        }

        .search-bar-wide {
            width: 100%;
            max-width: 100%;
            background: #eef7f3;
            border-radius: 16px;
            box-shadow: 0 1px 6px rgba(120, 120, 100, 0.05);
            display: flex;
            align-items: center;
            padding: 18px 32px;
            margin: 0 auto 32px auto;
            font-size: 1.18em;
            position: relative;
            z-index: 3;
        }

        .search-bar-wide input {
            border: none;
            background: transparent;
            flex: 1;
            font-size: 1.08em;
            padding: 4px 8px;
            outline: none;
            color: #2d2c2c;
        }

        #rankList {
            display: flex;
            gap: 24px;
            margin: 0 0 28px 0;
            flex-wrap: nowrap;
            width: 100%;
            overflow-x: auto; /* Ï¢åÏö∞ Ïä§ÌÅ¨Î°§ */
            justify-content: flex-start;
            scrollbar-width: none; /* ÌååÏù¥Ïñ¥Ìè≠Ïä§ */
            -ms-overflow-style: none; /* IE/Edge */
        }

        #rankList::-webkit-scrollbar {
            display: none; /* ÌÅ¨Î°¨/ÏÇ¨ÌååÎ¶¨ */
        }

        .section-title {
            width: 100%;
            text-align: left;
            margin: 38px 0 12px 0;
            font-size: 2em;
            font-weight: bold;
            padding-left: 0;
        }

        @media (max-width: 1000px) {
            .featured-area {
                width: 98vw;
                min-width: 0;
                max-width: 100vw;
            }

            .pet-illust img {
                width: 35vw;
                min-width: 120px;
            }

            .search-bar-wide {
                padding: 10px 8vw;
            }
        }
    </style>
</head>
<body>
<div class="navbar">
    <div class="logo">üêæ Petory</div>
    <nav>
        <a href="#">Daily Photo Record</a>
        <a href="#">Community</a>
        <a href="#">Pet Places</a>
        <a href="#">Contact Us</a>
    </nav>
    <div class="search-login">
      <span class="search">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path
                d="M21 21l-3-3"/></svg>
        <input type="text" placeholder="Search"/>
      </span>
        <button class="login">login</button>
    </div>
</div>
<main>
    <div class="featured-area">
        <div class="pet-illust">
            <img src="/place-search-pet.png" alt="dog-cat"/>
        </div>
        <form id="searchForm" class="search-bar-wide" style="margin-bottom:32px;">
            <svg style="margin-right: 8px" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-3-3"/>
            </svg>
            <input id="keyword" type="text" placeholder="Search for pet-friendly places"/>
        </form>
        <!--Ïù∏Í∏∞ Îû≠ÌÇπ ÏòÅÏó≠-->
        <h2 class="section-title">Ïù∏Í∏∞ Îû≠ÌÇπ</h2>
        <div id="rankList"
             style="display: flex; gap: 24px; margin: 0 0 28px 0; flex-wrap: nowrap; overflow-x: auto; width: 98%;"></div>
        <div class="category-row">
            <div class="cat" data-category="CAFE"><img src="https://cdn-icons-png.flaticon.com/128/4062/4062340.png"
                                                       alt=""><span>Cafes</span>
            </div>
            <div class="cat" data-category="RESTAURANT"><img
                    src="https://cdn-icons-png.flaticon.com/128/8285/8285335.png"
                    alt=""><span>Restaurants</span></div>
            <div class="cat" data-category="HOSPITAL"><img src="https://cdn-icons-png.flaticon.com/128/2895/2895071.png"
                                                           alt=""><span>Hospitals</span></div>
            <div class="cat" data-category="STORE"><img src="https://cdn-icons-png.flaticon.com/128/8723/8723034.png"
                                                        alt=""><span>Store</span>
            </div>
            <div class="cat" data-category="BEAUTY"><img src="https://cdn-icons-png.flaticon.com/128/1057/1057369.png"
                                                         alt=""><span>Beauty</span>
            </div>
            <div class="cat" data-category="SCHOOL"><img src="https://cdn-icons-png.flaticon.com/128/2602/2602412.png"
                                                         alt=""><span>SCHOOL</span>
            </div>
            <div class="cat" data-category="ACCOMMODATION"><img
                    src="https://cdn-icons-png.flaticon.com/512/263/263115.png" alt=""><span>Stay</span>
            </div>
            <div class="cat" data-category="BAR"><img src="https://cdn-icons-png.flaticon.com/128/7438/7438539.png"
                                                      alt=""><span>Bar</span>
            </div>
            <div class="cat" data-category="CAMPING"><img src="https://cdn-icons-png.flaticon.com/128/2082/2082468.png"
                                                          alt=""><span>Camping</span>
            </div>
            <div class="cat" data-category="ETC"><img src="https://cdn-icons-png.flaticon.com/128/8246/8246333.png"
                                                      alt=""><span>ETC</span>
            </div>
        </div>
        <!--ÏßÄÎèÑ ÏòÅÏó≠-->
        <div class="map-section">
            <div id="map"></div>
        </div>
        <div id="searchResultList"
             style="width:100%;margin:18px 0 10px 0;padding:0;min-height:20px;"></div>
    </div>
</main>
<div id="placeDetail" style="
  position: fixed;
  top: 90px;
  right: 38px;
  width: 320px;
  max-height: 540px;
  overflow-y: auto;
  background: white;
  padding: 18px 18px 12px 18px;
  border: 1px solid #e5e5e5;
  border-radius: 18px;
  box-shadow: 0 2px 8px rgba(140,120,60,0.10);
  z-index: 100;
  display: none; /* Ï≤òÏùåÏóî Ïà®ÍπÄ */
"></div>
<footer class="footer">
    <div class="footer-section">About Us</div>
    <div class="footer-section">Contact</div>
    <div class="footer-section">Terms of Service</div>
</footer>
<div class="footer copyright">
    ¬©2025 Petory. All rights reserved.
</div>
<!-- Ïπ¥Ïπ¥Ïò§Îßµ Ïä§ÌÅ¨Î¶ΩÌä∏Îäî ÏïÑÎûò Ï≤òÎüº JSÎ°ú Ï∂îÍ∞Ä -->
<script type="text/javascript"
        src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=64228b435124560ed7067b335db86c9f&libraries=services"></script>
<script>
    // ÏûÑÏãú ÎßàÏª§(Í∞ïÏ°∞Ïö©)
    let tempMarker = null;

    var markers = [];

    var container = document.getElementById('map'); //ÏßÄÎèÑÎ•º Îã¥ÏùÑ ÏòÅÏó≠Ïùò DOM Î†àÌçºÎü∞Ïä§
    var options = { //ÏßÄÎèÑÎ•º ÏÉùÏÑ±Ìï† Îïå ÌïÑÏöîÌïú Í∏∞Î≥∏ ÏòµÏÖò
        center: new kakao.maps.LatLng(37.566826, 126.9786567), //ÏßÄÎèÑÏùò Ï§ëÏã¨Ï¢åÌëú.
        level: 3 //ÏßÄÎèÑÏùò Î†àÎ≤®(ÌôïÎåÄ, Ï∂ïÏÜå Ï†ïÎèÑ)
    };

    var map = new kakao.maps.Map(container, options); //ÏßÄÎèÑ ÏÉùÏÑ± Î∞è Í∞ùÏ≤¥ Î¶¨ÌÑ¥

    // Ïû•ÏÜå Í≤ÄÏÉâ Í∞ùÏ≤¥Î•º ÏÉùÏÑ±Ìï©ÎãàÎã§
    var ps = new kakao.maps.services.Places();

    // Í≤ÄÏÉâ Í≤∞Í≥º Î™©Î°ùÏù¥ÎÇò ÎßàÏª§Î•º ÌÅ¥Î¶≠ÌñàÏùÑ Îïå Ïû•ÏÜåÎ™ÖÏùÑ ÌëúÏ∂úÌï† Ïù∏Ìè¨ÏúàÎèÑÏö∞Î•º ÏÉùÏÑ±Ìï©ÎãàÎã§
    var infowindow = new kakao.maps.InfoWindow({zIndex: 1});

    window.onload = function () {
        console.log('onload Ïã§ÌñâÎê®');
        initMap();
        fetchAndDisplayRankList(); // ALL Ïù∏Í∏∞ Ïû•ÏÜå Í∏∞Î≥∏ ÌëúÏãú
    };

    function initMap() {
        fetch('/places?size=3000')
            .then(response => response.json())
            .then(res => {
                allPlaces = res.data.content; // Ï†ÑÏ≤¥ Î™©Î°ù Ï†ÄÏû•
            });
    };

    function searchPlaces(page = 0) {
        const keyword = document.getElementById('keyword').value.trim();
        const size = 10;

        if (!keyword) {
            alert('Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî.');
            return;
        }

        fetch(`/places?placeName=${encodeURIComponent(keyword)}&page=${page}&size=${size}`)
            .then(response => response.json())
            .then(res => {
                const data = res.data;

                console.log('[Í≤ÄÏÉâ ÏùëÎãµ data]', data);
                if (!data || !Array.isArray(data.content)) {
                    alert('Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÍ±∞ÎÇò Îç∞Ïù¥ÌÑ∞ ÌòïÏãùÏù¥ ÏûòÎ™ªÎêòÏóàÏäµÎãàÎã§.');
                    return;
                }

                const places = data.content;
                displayPlaces(places);

                // displayPagination({
                //     current: data.number + 1,
                //     last: data.totalPages,
                //     gotoPage: function (p) {
                //         searchPlaces(p - 1);  // pageÎäî 0Î∂ÄÌÑ∞ ÏãúÏûë
                //     }
                // });
            })
            .catch(err => {
                console.error("Í≤ÄÏÉâ Ïã§Ìå®:", err);
                alert("Í≤ÄÏÉâ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
            });
        fetchAndDisplayRankList();
    }

    // Í≤ÄÏÉâ Í≤∞Í≥º Î™©Î°ùÍ≥º ÎßàÏª§Î•º ÌëúÏ∂úÌïòÎäî Ìï®ÏàòÏûÖÎãàÎã§
    function displayPlaces(places) {
        var listEl = document.getElementById('searchResultList');
        listEl.innerHTML = ''; // Ï¥àÍ∏∞Ìôî

        // Í∏∞Ï°¥ ÎßàÏª§ Ï†úÍ±∞
        removeMarker();

        if (!places || places.length === 0) {
            listEl.innerHTML = '<div style="color:#aaa;text-align:center;">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>';
            return;
        }

        // ÏßÄÎèÑ bounds Ï¥àÍ∏∞Ìôî
        var bounds = new kakao.maps.LatLngBounds();

        for (let i = 0; i < places.length; i++) {
            const place = places[i];
            const item = document.createElement('div');
            item.style.border = '1px solid #eee';
            item.style.borderRadius = '10px';
            item.style.padding = '12px';
            item.style.marginBottom = '10px';
            item.style.cursor = 'pointer';
            item.style.background = '#fff';
            item.innerHTML = `
            <div style="font-weight:600;font-size:1.08em;">${place.placeName}</div>
            <div style="font-size:0.97em;color:gray;">${place.address}</div>
            <div style="margin-top:6px;">‚ô•Ô∏è ${place.likeCount ?? 0} &nbsp; ‚≠ê ${place.ratio ?? '-'}</div>
        `;
            // ÌÅ¥Î¶≠Ïãú ÏÉÅÏÑ∏Ï†ïÎ≥¥
            item.onclick = function () {
                fetch(`/places/${place.id}`)
                    .then(res => res.json())
                    .then(data => showPlaceDetail(data));
                moveAndShowTempMarker(place);
            };
            listEl.appendChild(item);

            // ÏßÄÎèÑÏóê ÎßàÏª§ Ï∂îÍ∞Ä
            if (place.latitude && place.longitude) {
                const position = new kakao.maps.LatLng(place.latitude, place.longitude);
                const marker = addMarker(position, i, place);
                bounds.extend(position);
            }
        }

        // ÏßÄÎèÑ Î≤îÏúÑ Ïû¨ÏÑ§Ï†ï
        if (!bounds.isEmpty()) {
            map.setBounds(bounds);
        }
    }

    // ÎßàÏª§Î•º ÏÉùÏÑ±ÌïòÍ≥† ÏßÄÎèÑ ÏúÑÏóê ÎßàÏª§Î•º ÌëúÏãúÌïòÎäî Ìï®ÏàòÏûÖÎãàÎã§
    function addMarker(position, idx, place) {
        var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png', // ÎßàÏª§ Ïù¥ÎØ∏ÏßÄ url, Ïä§ÌîÑÎùºÏù¥Ìä∏ Ïù¥ÎØ∏ÏßÄÎ•º ÏîÅÎãàÎã§
            imageSize = new kakao.maps.Size(36, 37),  // ÎßàÏª§ Ïù¥ÎØ∏ÏßÄÏùò ÌÅ¨Í∏∞
            imgOptions = {
                spriteSize: new kakao.maps.Size(36, 691), // Ïä§ÌîÑÎùºÏù¥Ìä∏ Ïù¥ÎØ∏ÏßÄÏùò ÌÅ¨Í∏∞
                spriteOrigin: new kakao.maps.Point(0, (idx * 46) + 10), // Ïä§ÌîÑÎùºÏù¥Ìä∏ Ïù¥ÎØ∏ÏßÄ Ï§ë ÏÇ¨Ïö©Ìï† ÏòÅÏó≠Ïùò Ï¢åÏÉÅÎã® Ï¢åÌëú
                offset: new kakao.maps.Point(13, 37) // ÎßàÏª§ Ï¢åÌëúÏóê ÏùºÏπòÏãúÌÇ¨ Ïù¥ÎØ∏ÏßÄ ÎÇ¥ÏóêÏÑúÏùò Ï¢åÌëú
            },
            markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imgOptions),
            marker = new kakao.maps.Marker({
                position: position, // ÎßàÏª§Ïùò ÏúÑÏπò
                image: markerImage
            });

        marker.setMap(map); // ÏßÄÎèÑ ÏúÑÏóê ÎßàÏª§Î•º ÌëúÏ∂úÌï©ÎãàÎã§
        markers.push(marker);  // Î∞∞Ïó¥Ïóê ÏÉùÏÑ±Îêú ÎßàÏª§Î•º Ï∂îÍ∞ÄÌï©ÎãàÎã§

        // ÎßàÏª§ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
        kakao.maps.event.addListener(marker, 'click', function () {
            // ÏÉÅÏÑ∏Ï°∞Ìöå
            fetch(`/places/${place.id}`)
                .then(res => res.json())
                .then(data => showPlaceDetail(data));
            moveAndShowTempMarker(place);
        });

        return marker;
    }

    // ÏßÄÎèÑ ÏúÑÏóê ÌëúÏãúÎêòÍ≥† ÏûàÎäî ÎßàÏª§Î•º Î™®Îëê Ï†úÍ±∞Ìï©ÎãàÎã§
    function removeMarker() {
        for (var i = 0; i < markers.length; i++) {
            markers[i].setMap(null);
        }
        markers = [];
    }

    // // Í≤ÄÏÉâÍ≤∞Í≥º Î™©Î°ù ÌïòÎã®Ïóê ÌéòÏù¥ÏßÄÎ≤àÌò∏Î•º ÌëúÏãúÎäî Ìï®ÏàòÏûÖÎãàÎã§
    // function displayPagination(pagination) {
    //     var paginationEl = document.getElementById('pagination'),
    //         fragment = document.createDocumentFragment(),
    //         i;
    //
    //     // Í∏∞Ï°¥Ïóê Ï∂îÍ∞ÄÎêú ÌéòÏù¥ÏßÄÎ≤àÌò∏Î•º ÏÇ≠Ï†úÌï©ÎãàÎã§
    //     while (paginationEl.hasChildNodes()) {
    //         paginationEl.removeChild(paginationEl.lastChild);
    //     }
    //
    //     for (i = 1; i <= pagination.last; i++) {
    //         var el = document.createElement('a');
    //         el.href = "#";
    //         el.innerHTML = i;
    //
    //         if (i === pagination.current) {
    //             el.className = 'on';
    //         } else {
    //             el.onclick = (function (i) {
    //                 return function () {
    //                     pagination.gotoPage(i);
    //                 }
    //             })(i);
    //         }
    //
    //         fragment.appendChild(el);
    //     }
    //     paginationEl.appendChild(fragment);
    // }

    function showPlaceDetail(data) {
        const detailDiv = document.getElementById("placeDetail");
        const place = data.data;

        detailDiv.style.display = "block";

        detailDiv.innerHTML = `
        <button onclick="document.getElementById('placeDetail').style.display='none'"
            style="float:right;border:none;background:none;font-size:18px;color:#aaa;cursor:pointer;">√ó</button>
        <div style="text-align: center; margin-top: 8px;">
            <h3 style="margin-bottom: 10px;">${place.placeName ?? 'Ïù¥Î¶Ñ ÏóÜÏùå'}</h3>
            <img src="${place.placePhoto ?? 'https://via.placeholder.com/250x150?text=No+Image'}"
                alt="Ïû•ÏÜå ÏÇ¨ÏßÑ"
                style="width: 100%; max-height: 180px; object-fit: cover; border-radius: 8px;" />
        </div>
        <div style="margin-top: 10px;">
            <p><strong>Ï£ºÏÜå:</strong> ${place.address ?? 'Ï£ºÏÜå ÏóÜÏùå'}</p>
            <p><strong>ÌèâÏ†ê:</strong> ${place.ratio ?? 'ÏóÜÏùå'}</p>
            <p><string>Ï¢ãÏïÑÏöî Ïàò:</string>${place.likeCount ?? 0}</p>
            <p><strong>ÏÑ§Î™Ö:</strong> ${place.placeInfo ?? 'ÏÑ§Î™Ö ÏóÜÏùå'}</p>
        </div>
        <hr />
        <h4>Î¶¨Î∑∞</h4>
        <div>
            ${Array.isArray(place.placeReviewList) && place.placeReviewList.length > 0
            ? place.placeReviewList.map(r => `<p>‚≠ê ${r.ratio ?? '-'} - ${r.content ?? ''}</p>`).join('')
            : '<p>Î¶¨Î∑∞ Ï†ïÎ≥¥ ÏóÜÏùå</p>'}
        </div>
    `;
    }

    // Í≤ÄÏÉâÍ≤∞Í≥º Î™©Î°ù ÎòêÎäî ÎßàÏª§Î•º ÌÅ¥Î¶≠ÌñàÏùÑ Îïå Ìò∏Ï∂úÎêòÎäî Ìï®ÏàòÏûÖÎãàÎã§
    // Ïù∏Ìè¨ÏúàÎèÑÏö∞Ïóê Ïû•ÏÜåÎ™ÖÏùÑ ÌëúÏãúÌï©ÎãàÎã§
    function displayInfowindow(marker, title) {
        var content = '<div style="padding:5px;z-index:1;">' + title + '</div>';

        infowindow.setContent(content);
        infowindow.open(map, marker);
    }

    document.getElementById('searchForm').addEventListener('submit', function (e) {
        e.preventDefault(); // Í∏∞Î≥∏ Ï†úÏ∂ú(ÏÉàÎ°úÍ≥†Ïπ®) ÎßâÍ∏∞
        searchPlaces();     // Í≤ÄÏÉâ Ïã§Ìñâ (page=0 ÏúºÎ°ú ÏãúÏûë)
    });

    // Ïù∏Í∏∞ Ïû•ÏÜå Îû≠ÌÇπ
    function fetchAndDisplayRankList(placeType) {

        console.log("Ìï®Ïàò Ïã§ÌñâÎê®", placeType);

        // placeTypeÏù¥ ÏóÜÏúºÎ©¥ 'ALL'
        const type = placeType ? encodeURIComponent(placeType) : 'ALL';

        fetch(`/places/rank?placeType=${type}`) // Ïù∏Í∏∞ Îû≠ÌÇπ api
            .then(res => res.json())
            .then(result => {
                console.log('Îû≠ÌÇπ API ÏùëÎãµ:', result);
                console.log('typeof result.data:', typeof result.data);
                console.log('Array.isArray(result.data):', Array.isArray(result.data));
                console.log('result.data.length:', result.data && result.data.length);
                displayRankList(result.data ?? []);
            })
            .catch(err => {
                console.error('Ïù∏Í∏∞ Îû≠ÌÇπ Ï°∞Ìöå Ïã§Ìå®', err);
            });
    }

    function fetchPlacesByCategory(type) {
        // typeÏù¥ ALLÏùº ÎïåÎäî Ï†ÑÏ≤¥ Ï°∞Ìöå
        let url = '/places?size=20'; // sizeÎäî ÏõêÌïòÎäî ÎßåÌÅº
        if (type && type !== 'ALL') {
            url += `&placeType=${encodeURIComponent(type)}`;
        }

        fetch(url)
            .then(res => res.json())
            .then(result => {
                // ÎßåÏïΩ data.content Íµ¨Ï°∞ÎùºÎ©¥ ‚Üì
                displayPlaces(result.data.content || []);
            })
            .catch(err => {
                console.error('Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Ïû•ÏÜå Ï°∞Ìöå Ïã§Ìå®', err);
            });
    }


    // Ïù∏Í∏∞ Îû≠ÌÇπ Î¶¨Ïä§Ìä∏ UI
    function displayRankList(rankList) {
        const rankDiv = document.getElementById('rankList');
        rankDiv.innerHTML = ""; // Ï¥àÍ∏∞Ìôî

        console.log("Ïã§Ï†ú Ï†ÑÎã¨Î∞õÏùÄ rankList", rankList);
        console.log("typeof rankList:", typeof rankList);
        console.log("Array.isArray(rankList):", Array.isArray(rankList));
        console.log("rankList.constructor:", rankList.constructor);

        if (!Array.isArray(rankList) || rankList.length === 0) {
            rankDiv.innerHTML = '<div style="margin:auto; color:#888;"> Ïù∏Í∏∞ Ïû•ÏÜå Îû≠ÌÇπÏù¥ ÏóÜÏäµÎãàÎã§ </div>';
            return;
        }

        for (let i = 0; i < rankList.length; i++) {
            const place = rankList[i];
            console.log("forÎ¨∏ place", place);

            const item = document.createElement('div');
            item.style.minWidth = "180px";
            item.style.padding = "12px";
            item.style.background = "#fff";
            item.style.border = "1px solid #e5e5e5";
            item.style.borderRadius = "10px";
            item.style.textAlign = "center";
            item.style.cursor = "pointer";
            item.style.flex = "0 0 auto";
            item.innerHTML = `
                <div style="font-weight:bold; font-size:1.2em;">${i + 1}ÏúÑ</div>
                <div style="margin:8px 0; font-weight:600;">${place.placeName}</div>
                <div style="color:gray; font-size:0.95em;">${place.address ?? ''}</div>
                <div style="margin-top:6px;">‚ô•Ô∏è ${place.likeCount ?? 0} &nbsp; ‚≠ê ${place.ratio ?? '-'}</div>
            `;

            // ÏÉÅÏÑ∏Î≥¥Í∏∞ Ïó∞Í≤∞
            item.onclick = function () {
                fetch(`/places/${place.id}`)
                    .then(res => res.json())
                    .then(data => {
                        showPlaceDetail(data);
                    });
                moveAndShowTempMarker(place);
            };
            rankDiv.appendChild(item);
        }
    }

    // ÏûÑÏãú ÎßàÏª§ Ìï®Ïàò
    function showTempMarker(latLng) {
        // Í∏∞Ï°¥ ÏûÑÏãúÎßàÏª§ ÏßÄÏö∞Í∏∞
        if (tempMarker) {
            tempMarker.setMap(null);
        }
        tempMarker = new kakao.maps.Marker({
            position: latLng,
            image: new kakao.maps.MarkerImage(
                "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png",
                new kakao.maps.Size(40, 42)
            )
        });
        tempMarker.setMap(map);
    }

    // ÏûÑÏãú ÎßàÏª§Îßå Î≥¥Ïù¥Í≤å ÌïòÎäî Ìï®Ïàò
    function moveAndShowTempMarker(place) {
        if (place.latitude && place.longitude) {
            var latLng = new kakao.maps.LatLng(place.latitude, place.longitude);

            // ÏßÄÎèÑ Ïù¥Îèô Î∞è ÌôïÎåÄ
            map.setLevel(2);
            map.panTo(latLng);

            // Í∏∞Ï°¥ ÏûÑÏãú ÎßàÏª§ Ï†úÍ±∞
            if (tempMarker) {
                tempMarker.setMap(null);
            }
            // ÏÉàÎ°úÏö¥ ÏûÑÏãú ÎßàÏª§ Ï∞çÍ∏∞
            tempMarker = new kakao.maps.Marker({
                position: latLng,
                image: new kakao.maps.MarkerImage(
                    "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png",
                    new kakao.maps.Size(40, 42)
                )
            });
            tempMarker.setMap(map);
        }
    }


    // Ïπ¥ÌÖåÍ≥†Î¶¨ ÌÅ¥Î¶≠ Ïãú Ïù∏Í∏∞ Îû≠ÌÇπ ÏöîÏ≤≠
    document.querySelectorAll('.category-row .cat').forEach(cat => {
        cat.addEventListener('click', function () {
            //Î™®Îì† Ïπ¥ÌÖåÍ≥†Î¶¨ÏóêÏÑú active Ìï¥Ï†ú
            document.querySelectorAll('.category-row .cat').forEach(c => c.classList.remove('active'));
            //ÌòÑÏû¨ ÌÅ¥Î¶≠Îêú Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê active Ïä§ÌÉÄÏùº Ï†ÅÏö©
            cat.classList.add('active');

            const type = cat.dataset.category;
            fetchAndDisplayRankList(type);
            fetchPlacesByCategory(type);
        });
    });

    // Ïù∏Í∏∞ Îû≠ÌÇπ Ïª§ÏÑú Í¥ÄÎ†®
    const rankList = document.getElementById('rankList');
    let isDown = false;
    let startX;
    let scrollLeft;

    // ÎßàÏö∞Ïä§ Ïù¥Î≤§Ìä∏
    rankList.addEventListener('mousedown', (e) => {
        isDown = true;
        rankList.classList.add('dragging');
        startX = e.pageX - rankList.offsetLeft;
        scrollLeft = rankList.scrollLeft;
    });
    rankList.addEventListener('mouseleave', () => {
        isDown = false;
        rankList.classList.remove('dragging');
    });
    rankList.addEventListener('mouseup', () => {
        isDown = false;
        rankList.classList.remove('dragging');
    });
    rankList.addEventListener('mousemove', (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - rankList.offsetLeft;
        const walk = (x - startX) * 1.5;
        rankList.scrollLeft = scrollLeft - walk;
    });

    // ÌÑ∞Ïπò(Î™®Î∞îÏùº) Ïù¥Î≤§Ìä∏
    rankList.addEventListener('touchstart', (e) => {
        isDown = true;
        startX = e.touches[0].pageX - rankList.offsetLeft;
        scrollLeft = rankList.scrollLeft;
    });
    rankList.addEventListener('touchend', () => {
        isDown = false;
    });
    rankList.addEventListener('touchmove', (e) => {
        if (!isDown) return;
        const x = e.touches[0].pageX - rankList.offsetLeft;
        const walk = (x - startX) * 1.5;
        rankList.scrollLeft = scrollLeft - walk;
    });

    // Ïπ¥ÌÖåÍ≥†Î¶¨ ÎìúÎûòÍ∑∏ Ïä§ÌÅ¨Î°§
    const categoryRow = document.querySelector('.category-row');
    let isCategoryDown = false;
    let categoryStartX;
    let categoryScrollLeft;

    categoryRow.addEventListener('mousedown', (e) => {
        isCategoryDown = true;
        categoryRow.classList.add('dragging');
        categoryStartX = e.pageX - categoryRow.offsetLeft;
        categoryScrollLeft = categoryRow.scrollLeft;
    });
    categoryRow.addEventListener('mouseleave', () => {
        isCategoryDown = false;
        categoryRow.classList.remove('dragging');
    });
    categoryRow.addEventListener('mouseup', () => {
        isCategoryDown = false;
        categoryRow.classList.remove('dragging');
    });
    categoryRow.addEventListener('mousemove', (e) => {
        if (!isCategoryDown) return;
        e.preventDefault();
        const x = e.pageX - categoryRow.offsetLeft;
        const walk = (x - categoryStartX) * 1.5;
        categoryRow.scrollLeft = categoryScrollLeft - walk;
    });

    // ÌÑ∞Ïπò(Î™®Î∞îÏùº) ÏßÄÏõê
    categoryRow.addEventListener('touchstart', (e) => {
        isCategoryDown = true;
        categoryStartX = e.touches[0].pageX - categoryRow.offsetLeft;
        categoryScrollLeft = categoryRow.scrollLeft;
    });
    categoryRow.addEventListener('touchend', () => {
        isCategoryDown = false;
    });
    categoryRow.addEventListener('touchmove', (e) => {
        if (!isCategoryDown) return;
        const x = e.touches[0].pageX - categoryRow.offsetLeft;
        const walk = (x - categoryStartX) * 1.5;
        categoryRow.scrollLeft = categoryScrollLeft - walk;
    });
</script>
</body>
</html>